@startuml CommandsMaster
!includeurl https://raw.githubusercontent.com/momenttech/plantuml/master/globals/commons.puml
'!include ./globals/commons.puml
'skinparam linetype ortho
'skinparam linetype polyline
'left to right direction
'top to bottom direction
skinparam nodesep 30
skinparam ranksep 20
scale 1
' rectangle "Master Inputs" as MasterQuestions {
'     actor "Ask: who is master" as MasterAsk
'     actor "Reply: I'm master" as MasterReply
'     MasterAsk .[hidden]. MasterReply
' }

skinparam rectangle<<QUEUES>>{
    FontColor $PURPLE
    FontStyle none
	BorderColor $PURPLE
	BackgroundColor #White|LightSteelBlue
}
skinparam rectangle<<EXCHANGE>>{
    FontColor $PURPLE
    FontStyle none
	BorderColor $PURPLE
	BackgroundColor #White|LightSeaGreen
}


rectangle "RabbitMQ Broker" as RmqBroker {
    
    rectangle "Master's Inputs Queue" <<QUEUES>> as RmqQueuesIn {
        card Card_TbottAdmin [
            tbott_admin_master
            ___
            ---
            ---
            ---
            ---
        ]
    }
    rectangle "Topic Exchanges" <<EXCHANGE>> as TopicEx {
        control "tbott_admin_master" as ExchTbott

    }
    rectangle "Admins' Queues" <<QUEUES>> as RmqQueuesOut {
        card Card_A0P0T0Q1 [
            A0_P0_prod_<b>Q</b>_uid1
            ___
            ---
            ---
            ---
            ---
        ]
        card Card_A0P0T0A1 [
            A0_P0_prod_<b>A</b>_uid1
            ___
            ---
            ---
            ---
            ---
            ---
        ]
        card Card_A0P0T0A2 [
            A0_P0_prod_<b>Q</b>_uid2
            ___
            ---
            ---
            ---
            ---
            ---
        ]
        card Card_A0P0T0Q2 [
            A0_P0_prod_<b>A</b>_uid2
            ___
            ---
            ---
            ---
            ---
            ---
        ]

    }

}

'MasterAsk -l-> Card_TbottAdmin
'MasterReply -l-> Card_TbottAdmin
Card_TbottAdmin -d-> ExchTbott

ExchTbott --> Card_A0P0T0A1: "routing:\nA0.P0.prod.<b>A</b>.#"
ExchTbott --> Card_A0P0T0Q1: "routing:\nA0.P0.prod.<b>Q</b>.#"
ExchTbott --> Card_A0P0T0A2: "routing:\nA0.P0.prod.<b>A</b>.#"
ExchTbott --> Card_A0P0T0Q2: "routing:\nA0.P0.prod.<b>Q</b>.#"

frame "Admin" as FrameA0P0T1 {
    component CompA0P0T1 [
        Domain: <b>A0</b> (cfg)
        Project: <b>P0</b> (cfg)
        Target: <b>prod</b> (cfg)
        Uuid : uid1 (auto.)
    ]
}

frame "Admin" as FrameA0P0T2 {
    component CompA0P0T2 [
        Domain: <b>A0</b> (cfg)
        Project: <b>P0</b> (cfg)
        Target: <b>prod</b> (cfg)
        Uuid : uid2 (auto.)
    ]
}

FrameA0P0T1 -> Card_TbottAdmin: "Who is\nmaster\nA0.P0.prod.<b>Q</b>.#"
FrameA0P0T2 -> Card_TbottAdmin: "I'm\nmaster\nA0.P0.prod.<b>A</b>.#"
'Com -u-> MasterQuestions

Card_A0P0T0A1 --> CompA0P0T1: topic\nA0.P0.prod.<b>A</b>.uid1
Card_A0P0T0Q1 --> CompA0P0T1: topic\nA0.P0.prod.<b>Q</b>.uid1
Card_A0P0T0A2 --> CompA0P0T2: topic\nA0.P0.prod.<b>A</b>.uid2
Card_A0P0T0Q2 --> CompA0P0T2: topic\nA0.P0.prod.<b>Q</b>.uid2


@enduml