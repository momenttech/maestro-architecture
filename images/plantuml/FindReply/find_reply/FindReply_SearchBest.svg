<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="735.4167px" preserveAspectRatio="none" style="width:629px;height:735px;background:#00000000;" version="1.1" viewBox="0 0 629 735" width="629.1667px" zoomAndPan="magnify"><defs><filter height="300%" id="fb669iyucbdq7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0833333333333335"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.166666666666667" dy="4.166666666666667" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter><linearGradient id="gb669iyucbdq70" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FF0000"/><stop offset="100%" stop-color="#FFFF00"/></linearGradient><linearGradient id="gb669iyucbdq71" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#0000FF"/><stop offset="100%" stop-color="#FFFFFF"/></linearGradient></defs><g><!--MD5=[5a67b7ef1662e0e5eb1558fe4777d068]
cluster SearchBest--><rect fill="#FFFFFF" filter="url(#fb669iyucbdq7)" height="612.5" rx="4.1667" ry="4.1667" style="stroke: #2683B9; stroke-width: 1.5625;" width="443.75" x="173.9583" y="111.4583"/><path d="M283.3333,112.5 L283.3333,129.1341 L272.9167,139.5508 L173.9583,139.5508 " fill="none" style="stroke: #2683B9; stroke-width: 1.5625;"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88.5417" x="182.2917" y="129.3111">Search Best</text><!--MD5=[0b6da4d3acf42b1a006f10501b03f29a]
entity GetCtx--><rect fill="#FFFFFF" filter="url(#fb669iyucbdq7)" height="106.1523" rx="4.1667" ry="4.1667" style="stroke: #2683B9; stroke-width: 1.5625;" width="322.9167" x="223.9583" y="233.3333"/><rect fill="#FFFFFF" height="10.4167" style="stroke: #2683B9; stroke-width: 1.5625;" width="15.625" x="526.0417" y="238.5417"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="523.9583" y="240.625"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="523.9583" y="244.7917"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="140.625" x="244.7917" y="270.9778">if type == "question":</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="270.8333" x="244.7917" y="295.9452">&gt; get N1/N2 contexts @ 127.0.0.1:14001</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="143.75" x="244.7917" y="320.9127">&gt; extend question list</text><!--MD5=[7be7f317a0ea0c634215121d8fef2d75]
entity GetVects--><rect fill="#FFFFFF" filter="url(#fb669iyucbdq7)" height="56.2174" rx="4.1667" ry="4.1667" style="stroke: #2683B9; stroke-width: 1.5625;" width="268.75" x="270.8333" y="362.5"/><rect fill="#FFFFFF" height="10.4167" style="stroke: #2683B9; stroke-width: 1.5625;" width="15.625" x="518.75" y="367.7083"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="516.6667" y="369.7917"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="516.6667" y="373.9583"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="216.6667" x="291.6667" y="400.1444">get vectors @ $ENCODER_QUEUE</text><!--MD5=[3cbeaa90f45d418792d3fe0131e2a8b6]
entity AskFaiss--><rect fill="#FFFFFF" filter="url(#fb669iyucbdq7)" height="81.1849" rx="4.1667" ry="4.1667" style="stroke: #2683B9; stroke-width: 1.5625;" width="378.125" x="223.4375" y="441.6667"/><rect fill="#FFFFFF" height="10.4167" style="stroke: #2683B9; stroke-width: 1.5625;" width="15.625" x="580.7292" y="446.875"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="578.6458" y="448.9583"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="578.6458" y="453.125"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="326.0417" x="244.2708" y="479.3111">get candidates IDs from FAISS @ 127.0.0.1:14000</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="84.375" x="244.2708" y="504.2786">rearange IDs</text><!--MD5=[fe5f9f92828b1c2fccf346540a4e6477]
entity GetVectAdm--><rect fill="#FFFFFF" filter="url(#fb669iyucbdq7)" height="56.2174" rx="4.1667" ry="4.1667" style="stroke: #2683B9; stroke-width: 1.5625;" width="340.625" x="223.4375" y="545.8333"/><rect fill="#FFFFFF" height="10.4167" style="stroke: #2683B9; stroke-width: 1.5625;" width="15.625" x="543.2292" y="551.0417"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="541.1458" y="553.125"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="541.1458" y="557.2917"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="48.9583" x="244.2708" y="583.4778">get IDs'</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73.9583" x="297.3958" y="583.4778">questions</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="25" x="375.5208" y="583.4778">and</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51.0417" x="404.6875" y="583.4778">replies</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="72.9167" x="459.8958" y="583.4778">from Admin</text><!--MD5=[c5a1ccf7239e9782fa8c48518b78c9ad]
entity getBestMatching--><rect fill="#FFFFFF" filter="url(#fb669iyucbdq7)" height="81.1849" rx="4.1667" ry="4.1667" style="stroke: #2683B9; stroke-width: 1.5625;" width="317.7083" x="202.6042" y="626.0417"/><rect fill="#FFFFFF" height="10.4167" style="stroke: #2683B9; stroke-width: 1.5625;" width="15.625" x="499.4792" y="631.25"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="497.3958" y="633.3333"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="497.3958" y="637.5"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="180.2083" x="223.4375" y="663.6861">create list of paired vectors</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="265.625" x="223.4375" y="688.6536">get best Matching @ $MATCHING_QUEUE</text><!--MD5=[b4655307bea1750bf10a3711aa3c6075]
entity RetBet--><rect fill="#FFFFFF" filter="url(#fb669iyucbdq7)" height="56.2174" rx="4.1667" ry="4.1667" style="stroke: #2683B9; stroke-width: 1.5625;" width="126.0417" x="196.3542" y="155.2083"/><rect fill="#FFFFFF" height="10.4167" style="stroke: #2683B9; stroke-width: 1.5625;" width="15.625" x="301.5625" y="160.4167"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="299.4792" y="162.5"/><rect fill="#FFFFFF" height="2.0833" style="stroke: #2683B9; stroke-width: 1.5625;" width="4.1667" x="299.4792" y="166.6667"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="73.9583" x="217.1875" y="192.8528">return best</text><!--MD5=[65a15915d2cc54585b137278ef6b7e75]
entity Admin1--><ellipse cx="132.2917" cy="273.9583" fill="url(#gb669iyucbdq70)" filter="url(#fb669iyucbdq7)" rx="12.5" ry="12.5" style="stroke: #6F42C1; stroke-width: 2.0833333333333335;"/><line style="stroke: #6F42C1; stroke-width: 2.0833333333333335;" x1="119.7917" x2="144.7917" y1="288.5417" y2="288.5417"/><text fill="#000000" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="39.5833" x="112.5" y="307.4361">Admin</text><!--MD5=[eee6185bd73f45d88be72cec907cd9c5]
entity Admin2--><ellipse cx="132.2917" cy="561.4583" fill="url(#gb669iyucbdq70)" filter="url(#fb669iyucbdq7)" rx="12.5" ry="12.5" style="stroke: #6F42C1; stroke-width: 2.0833333333333335;"/><line style="stroke: #6F42C1; stroke-width: 2.0833333333333335;" x1="119.7917" x2="144.7917" y1="576.0417" y2="576.0417"/><text fill="#000000" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="39.5833" x="112.5" y="594.9361">Admin</text><!--MD5=[3ceae401b49d0ad0fe702da941d15e72]
entity Faiss--><ellipse cx="135.4167" cy="469.7917" fill="url(#gb669iyucbdq71)" filter="url(#fb669iyucbdq7)" rx="12.5" ry="12.5" style="stroke: #6F42C1; stroke-width: 2.0833333333333335;"/><line style="stroke: #6F42C1; stroke-width: 2.0833333333333335;" x1="122.9167" x2="147.9167" y1="484.375" y2="484.375"/><text fill="#000000" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="33.3333" x="118.75" y="503.2694">Faiss</text><!--MD5=[577ee27765cb72cf7b02c80a46fe7b51]
entity Encoder--><ellipse cx="109.375" cy="378.125" fill="#FFFFFF" filter="url(#fb669iyucbdq7)" rx="12.5" ry="12.5" style="stroke: #2683B9; stroke-width: 2.0833333333333335;"/><line style="stroke: #2683B9; stroke-width: 2.0833333333333335;" x1="96.875" x2="121.875" y1="392.7083" y2="392.7083"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="85.4167" x="66.6667" y="411.6028">Bert Encoder</text><!--MD5=[0b4846db015581273f652c6d394a5ede]
entity Matcher--><ellipse cx="42.7083" cy="641.6667" fill="#FFFFFF" filter="url(#fb669iyucbdq7)" rx="12.5" ry="12.5" style="stroke: #2683B9; stroke-width: 2.0833333333333335;"/><line style="stroke: #2683B9; stroke-width: 2.0833333333333335;" x1="30.2083" x2="55.2083" y1="656.25" y2="656.25"/><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="62.5" x="11.4583" y="675.1444">Sentence</text><text fill="#2683B9" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="59.375" x="11.4583" y="700.1119">Matching</text><!--MD5=[5b265eb2fd3f1a0aa329f1963cffe059]
entity MSG_C--><ellipse cx="343.75" cy="45.8333" fill="#FFFFFF" filter="url(#fb669iyucbdq7)" rx="8.3333" ry="8.3333" style="stroke: #C71C22; stroke-width: 2.0833333333333335;"/><text fill="#343A40" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="42.7083" x="322.3958" y="80.3528">MSG_C</text><!--MD5=[772798b0a77b593c46a83d9d01daa4be]
link MSG_C to GetCtx--><path d="M345.2333,55.3646 C349.9823,82.5552 365.1063,169.1396 375.3833,227.976 " fill="none" id="MSG_C-&gt;GetCtx" style="stroke: #2FA4E7; stroke-width: 2.604166666666667; stroke-dasharray: 7.0,7.0;"/><polygon fill="#2FA4E7" points="376.3,233.225,378.7921,223.2731,375.4042,228.0943,370.583,224.7063,376.3,233.225" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><text fill="#343A40" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="63.5417" x="384.375" y="180.8736">Search Q.</text><text fill="#343A40" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="76.0417" x="378.125" y="195.4244">Thread 1..N</text><!--MD5=[b6223a3a6390dc20fa00adcaa859a578]
link RetBet to GetCtx--><!--MD5=[047457c171c94be8065864a2166fa3de]
link GetCtx to GetVects--><path d="M395.5448,339.7375 C396.6854,345.624 397.8229,351.4896 398.8948,357.0208 " fill="none" id="GetCtx-&gt;GetVects" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><polygon fill="#868E96" points="399.9438,362.4281,402.2503,352.4316,398.9527,357.315,394.0693,354.0173,399.9438,362.4281" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><!--MD5=[62895d07cdb544a06ce13b735ba82e7a]
link GetVects to AskFaiss--><path d="M407.4354,419.0313 C407.8781,424.4677 408.3542,430.3104 408.8302,436.1594 " fill="none" id="GetVects-&gt;AskFaiss" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><polygon fill="#868E96" points="409.2667,441.5219,412.6588,431.8397,408.844,436.3307,404.3529,432.5159,409.2667,441.5219" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><!--MD5=[c37a44f2f5b3f10a24b8bd2687bbbcc8]
link AskFaiss to GetVectAdm--><path d="M404.1667,523.1479 C402.9385,529.0146 401.6865,534.9979 400.4958,540.6865 " fill="none" id="AskFaiss-&gt;GetVectAdm" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><polygon fill="#868E96" points="399.4219,545.8167,405.4206,537.494,400.4888,540.7188,397.264,535.787,399.4219,545.8167" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><!--MD5=[1813dca5fe309a935a680031668006e9]
link GetVectAdm to getBestMatching--><path d="M384.0615,602.1906 C382,607.974 379.7719,614.2302 377.5438,620.4813 " fill="none" id="GetVectAdm-&gt;getBestMatching" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><polygon fill="#868E96" points="375.6771,625.7208,382.7492,618.2886,377.4255,620.8148,374.8994,615.4911,375.6771,625.7208" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><!--MD5=[06877c503610f9ba5727f110a1c60292]
reverse link RetBet to getBestMatching--><path d="M222.5333,215.276 C217.2625,220.8865 212.2948,226.9854 208.3333,233.3333 C195.4646,253.9521 191.6667,261.1125 191.6667,285.4167 C191.6667,285.4167 191.6667,285.4167 191.6667,575 C191.6667,596.7188 202.6125,613.251 218.9469,625.8302 " fill="none" id="RetBet&lt;-getBestMatching" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><polygon fill="#868E96" points="226.2219,211.4729,216.7041,215.3023,222.596,215.2119,222.6865,221.1037,226.2219,211.4729" style="stroke: #868E96; stroke-width: 2.604166666666667;"/><!--MD5=[54ac080d62da3b07971dc3a0e89da4c2]
reverse link MSG_C to RetBet--><path d="M335.6375,59.8948 C322.0344,81.726 294.351,126.1573 276.3469,155.0531 " fill="none" id="MSG_C&lt;-RetBet" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#2FA4E7" points="338.4719,55.3458,329.9771,61.0983,335.7171,59.766,337.0494,65.506,338.4719,55.3458" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><!--MD5=[17bf6e70bd950cfc4d74cb02577c3d96]
link Admin1 to GetCtx--><path d="M171.4958,286.4583 C184.3073,286.4583 211.3313,286.4583 211.3313,286.4583 " fill="none" id="Admin1-GetCtx" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#00000000" points="223.8313,286.4583,217.5813,282.2917,211.3313,286.4583,217.5813,290.625,223.8313,286.4583" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#2FA4E7" points="157.5052,286.4583,166.8802,290.625,162.7135,286.4583,166.8802,282.2917,157.5052,286.4583" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><line style="stroke: #2FA4E7; stroke-width: 2.604166666666667;" x1="162.7135" x2="171.0469" y1="286.4583" y2="286.4583"/><!--MD5=[9b0615f058061e7be644c4c3710bd288]
link Encoder to GetVects--><path d="M171.2313,390.625 C196.3958,390.625 258.3323,390.625 258.3323,390.625 " fill="none" id="Encoder-GetVects" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#00000000" points="270.8323,390.625,264.5823,386.4583,258.3323,390.625,264.5823,394.7917,270.8323,390.625" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#2FA4E7" points="157.5646,390.625,166.9396,394.7917,162.7729,390.625,166.9396,386.4583,157.5646,390.625" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><line style="stroke: #2FA4E7; stroke-width: 2.604166666666667;" x1="162.7729" x2="171.1063" y1="390.625" y2="390.625"/><text fill="#343A40" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="33.3333" x="197.3958" y="364.7278">Send</text><text fill="#343A40" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="80.2083" x="173.9583" y="379.2786">RPC request</text><path d="M231.5842,397.9907 A10.4167,10.4167 0 0 0 231.5842 383.2593" fill="#FFFFFF" style="stroke: #2FA4E7; stroke-width: 1.5625;"/><ellipse cx="224.2185" cy="390.625" fill="#FFFFFF" rx="6.25" ry="6.25" style="stroke: #2FA4E7; stroke-width: 1.5625;"/><!--MD5=[c82c8146aee7f8fa2805a5fe9c1ce465]
link Faiss to AskFaiss--><path d="M171.2104,482.2917 C183.9177,482.2917 210.6198,482.2917 210.6198,482.2917 " fill="none" id="Faiss-AskFaiss" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#00000000" points="223.1198,482.2917,216.8698,478.125,210.6198,482.2917,216.8698,486.4583,223.1198,482.2917" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#2FA4E7" points="157.3344,482.2917,166.7094,486.4583,162.5427,482.2917,166.7094,478.125,157.3344,482.2917" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><line style="stroke: #2FA4E7; stroke-width: 2.604166666666667;" x1="162.5427" x2="170.876" y1="482.2917" y2="482.2917"/><!--MD5=[57ae039b23fbf6a8d6f4e71fc269894a]
link Admin2 to GetVectAdm--><path d="M171.2438,573.9583 C183.999,573.9583 210.85,573.9583 210.85,573.9583 " fill="none" id="Admin2-GetVectAdm" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#00000000" points="223.35,573.9583,217.1,569.7917,210.85,573.9583,217.1,578.125,223.35,573.9583" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#2FA4E7" points="157.3135,573.9583,166.6885,578.125,162.5219,573.9583,166.6885,569.7917,157.3135,573.9583" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><line style="stroke: #2FA4E7; stroke-width: 2.604166666666667;" x1="162.5219" x2="170.8557" y1="573.9583" y2="573.9583"/><!--MD5=[0c71eff58df83eceeaf53b07c9051436]
link Matcher to getBestMatching--><path d="M93.1173,666.6667 C119.5094,666.6667 189.9042,666.6667 189.9042,666.6667 " fill="none" id="Matcher-getBestMatching" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#00000000" points="202.4042,666.6667,196.1542,662.5,189.9042,666.6667,196.1542,670.8333,202.4042,666.6667" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><polygon fill="#2FA4E7" points="79.273,666.6667,88.648,670.8333,84.4814,666.6667,88.648,662.5,79.273,666.6667" style="stroke: #2FA4E7; stroke-width: 2.604166666666667;"/><line style="stroke: #2FA4E7; stroke-width: 2.604166666666667;" x1="84.4814" x2="92.8147" y1="666.6667" y2="666.6666"/><text fill="#343A40" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="33.3333" x="124.2188" y="640.7694">Send</text><text fill="#343A40" font-family="Verdana" font-size="12.5" lengthAdjust="spacingAndGlyphs" textLength="80.2083" x="100.7813" y="655.3202">RPC request</text><path d="M158.7735,674.0324 A10.4167,10.4167 0 0 0 158.7735 659.301" fill="#FFFFFF" style="stroke: #2FA4E7; stroke-width: 1.5625;"/><ellipse cx="151.4078" cy="666.6667" fill="#FFFFFF" rx="6.25" ry="6.25" style="stroke: #2FA4E7; stroke-width: 1.5625;"/><!--MD5=[47c8aed353bd84b5ec38342cfcbd4a14]
@startuml FindReply_SearchBest




skinparam backgroundColor White








skinparam defaultFontName       "Verdana"
skinparam defaultFontSize       12
skinparam dpi                   100
skinparam shadowing             True
skinparam roundcorner           8
skinparam ParticipantPadding    40
skinparam BoxPadding            40
skinparam Padding               5
skinparam ArrowColor            #868E96
skinparam stereotype {
    CBackgroundColor #EDF0F2
    CBorderColor #BABDBF
    ABackgroundColor #8FB961
    ABorderColor $SUCCESS_DARK
    IBackgroundColor #D2494E
    IBorderColor $DANGER_DARK
    EBackgroundColor #E47833
    EBorderColor $WARNING_DARK
    NBackgroundColor #35638F
    NBorderColor $INFO_DARK
}
skinparam title {
	FontColor	                 #2FA4E7
	BorderColor	                 #BABDBF
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              White
}

skinparam legend {
	BackgroundColor White
	BorderColor #BABDBF
	FontColor #343A40
}


skinparam activity {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	BarColor #73A839
	StartColor #033C73
	EndColor #033C73
	DiamondBackgroundColor White
  	DiamondBorderColor #BABDBF
	DiamondFontColor #BABDBF
}


skinparam participant {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}


skinparam arrow {
	Thickness 2.5
	Color #2FA4E7
	FontColor #343A40
}


skinparam sequence {
	BorderColor #2FA4E7
	TitleFontColor #2FA4E7
	BackgroundColor White
	StartColor #2FA4E7
	EndColor #2FA4E7
	BoxBackgroundColor White
	BoxBorderColor #868E96
	BoxFontColor #343A40
	LifeLineBorderColor #BABDBF
	LifeLineBorderThickness 2
	LifeLineBackgroundColor White
	GroupBorderColor #868E96
	GroupFontColor #343A40
	GroupHeaderFontColor #033C73
	DividerBackgroundColor White
    DividerBorderColor #868E96
    DividerBorderThickness 2
    DividerFontColor #343A40
	ReferenceBackgroundColor White
	ReferenceBorderColor #868E96
	ReferenceFontColor #343A40
	ReferenceHeaderFontColor #033C73
}


skinparam partition {
	BorderColor #2FA4E7
	FontColor #2FA4E7
	BackgroundColor White
}


skinparam collections {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}


skinparam control {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}


skinparam entity {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}


skinparam boundary {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}


skinparam agent {
	BackgroundColor White
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor White
	BorderColor #033C73
	FontColor #033C73
}


skinparam artifact {
	BackgroundColor White
	BorderColor #868E96
	FontColor #868E96
}


skinparam component {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	
}


skinparam interface {
	BackgroundColor  White
	BorderColor  #C71C22
	FontColor #343A40
}


skinparam storage {
	BackgroundColor White
  	BorderColor #DD5600
	FontColor #DD5600
}


skinparam node {
	BackgroundColor White
	BorderColor #343A40
	FontColor #343A40
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor #F2FCFE
	FontColor #343A40
}


skinparam database {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}


skinparam class {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	HeaderBackgroundColor #2FA4E7-#2683B9
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam object {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #BABDBF
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam rectangle {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam package {
	BackgroundColor #F2FCFE-#eeeeee
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}


skinparam folder {
	BackgroundColor White
  	BorderColor #DD5600
	FontColor #DD5600
	BorderThickness 2
}


skinparam frame {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}



skinparam state {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
	StartColor #033C73
	EndColor #033C73
	AttributeFontColor #BABDBF
	AttributeFontSize 11
}


skinparam queue {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}


skinparam card {
	BackgroundColor White
	BorderColor #033C73
	FontColor #033C73
}


skinparam file {
	BackgroundColor White
	BorderColor #868E96
	FontColor #868E96
}


skinparam stack {
		FontColor #2683B9
	BorderColor #2683B9
	BackgroundColor White
}



hide stereotype

skinparam backgroundColor transparent
!pragma horizontalLineBetweenDifferentPackageAllowed

skinparam file<<NOTE>> {
	BorderThickness 0.5
    BackgroundColor LightYellow
	BorderColor LightSteelBlue
	FontColor SteelBlue
    FontSize 10
    ArrowColor LightSteelBlue
}
skinparam arrow<<NOTE>> {
    Color LightSteelBlue
}





skinparam node<<MULTITHREADED>>{
    FontColor #E47833
	BorderColor #E47833
	BackgroundColor White
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam package<<CONTAINER>>{
    	BackgroundColor #eeeeee
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}
skinparam frame<<CONTAINER>>{
    	BackgroundColor #eeeeee
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}


skinparam rectangle<<boundary>> {
    BackgroundColor #eeeeee
    Shadowing false
    StereotypeFontSize 0
    FontColor #444444
    BorderColor #444444
    BorderStyle dashed
    BoxPadding 0
}

skinparam file<<docker_params>> {
    Shadowing True
    FontSize 10
}












skinparam nodesep 30
skinparam ranksep 20
skinparam componentStyle uml2

skinparam Entity<<ADMIN>>{
    FontColor black
	BorderColor #6F42C1
	BackgroundColor #Red/Yellow
}
skinparam Entity<<FAISS>>{
    FontColor black
	BorderColor #6F42C1
	BackgroundColor #Blue/White
}
skinparam arrow<<TEST>> {
	Thickness 1
	Color #73A839
	FontColor #343A40
}

skinparam arrow<<INTRA>> {
	Color #868E96
}


Entity "Admin" <<ADMIN>> as Admin1
Entity "Admin" <<ADMIN>> as Admin2
Entity Faiss <<FAISS>>
Entity "Bert Encoder" as Encoder
Entity "Sentence\nMatching" as Matcher

    
        frame "Search Best" as SearchBest {
            [if type == "question":\n > get N1/N2 contexts @ 127.0.0.1:14001\n > extend question list] as GetCtx
            [get vectors @ $ENCODER_QUEUE] as GetVects
            [get candidates IDs from FAISS @ 127.0.0.1:14000\nrearange IDs] as AskFaiss
            [get IDs' <b>questions</b> and <b>replies</b> from Admin] as GetVectAdm
            [create list of paired vectors\nget best Matching @ $MATCHING_QUEUE] as getBestMatching
            [return best] as RetBet

        }
        MSG_C ..> GetCtx: "Search Q.\nThread 1..N"

        RetBet -[hidden]-> GetCtx
        GetCtx -down-> GetVects<<INTRA>>
        GetVects -down-> AskFaiss<<INTRA>>
        AskFaiss -down-> GetVectAdm<<INTRA>>
        GetVectAdm -down-> getBestMatching<<INTRA>>
        getBestMatching -u-> RetBet<<INTRA>>

        RetBet -u-> MSG_C
            
        GetCtx o-l-> Admin1
        GetVects o-l0)-> Encoder: Send\nRPC request
        AskFaiss o-l-> Faiss
        GetVectAdm o-l-> Admin2
        getBestMatching o-l0)-> Matcher: Send\nRPC request


@enduml

PlantUML version 1.2020.08(Sun Apr 26 14:08:22 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-8u212-b01-1~deb9u1-b01
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>